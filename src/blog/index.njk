---
layout: layouts/base.njk
eleventyComputed:
  seo:
    title: "{{ blog.blog.meta.title }}"
    description: "{{ blog.blog.meta.description }}"
    canonical: "{{ blog.blog.meta.canonical }}"
---

{% set data = blog.blog %}
{% set meta = data.meta %}

<section id="cover">
    <img src="{{ data.coverImage }}" alt="">
    <div class="container">
        <div class="page-header">
            <h1 class="section-title">{{ data.headerTitle }}</h1>
            <p>{{ meta.description }}</p>
        </div>
    </div>
</section>

<main id="blog-list">
    <section>
        <div class="container">
            <h2>Liste des articles</h2>
            <div class="blog-layout">
                <!-- Articles List -->
                <div class="blog-articles">
                    {% for article in articles %}
                        <a href="/blog/{{ article.id }}/" class="article-card" data-category="{{ article.category | slugify }}">
                            <div class="article-card_image">
                                <img src="{{ article.image }}" alt="{{ article.title }}" loading="lazy">
                            </div>
                            <div class="article-card_content">
                                <div class="article-card_header">
                                    <h2 class="article-card_title">{{ article.title }}</h2>
                                    <span class="article-card_read-time">{{ article.readTime }}</span>
                                </div>
                                <p class="article-card_description">{{ article.description }}</p>
                                <div class="article-card_meta">
                                    <span>{{ article.date | formatDate }}</span> • 
                                    <span class="article-card_category">{{ article.category }}</span>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                    <div id="no-articles-message" class="blog-empty" style="display: none;">
                        <h3>Aucun article trouvé dans cette catégorie.</h3>
                    </div>
                </div>

                <!-- Category Table of Contents Sidebar -->
                <aside class="blog-toc">
                    <h3>Catégories</h3>
                    <nav>
                        <ul>
                            <li class="blog-toc_category">
                                <a href="#" class="active category-filter" data-filter="all">Tous les articles</a>
                            </li>
                            {% for category in collections.categories %}
                                <li class="blog-toc_category">
                                    <a href="#" class="category-filter" data-filter="{{ category.name | slugify }}">{{ category.name }} ({{ category.count }})</a>
                                </li>
                            {% endfor %}
                        </ul>
                    </nav>
                </aside>
            </div>
        </div>
        <nav aria-label="Pagination" class="pagination-nav">
            {% if pagination.href.previous %}<a href="{{ pagination.href.previous }}" rel="prev">Précédent</a>{% endif %}
            {% for href in pagination.hrefs %}
                <a href="{{ href }}" {% if loop.index0 == pagination.pageNumber %}aria-current="page" class="current"{% endif %}>
                    {{ loop.index }}
                </a>
            {% endfor %}
            {% if pagination.href.next %}<a href="{{ pagination.href.next }}" rel="next">Suivant</a>{% endif %}
        </nav>
    </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filters = document.querySelectorAll('.category-filter');
    const articlesContainer = document.querySelector('.blog-articles');
    const noArticlesMsg = document.getElementById('no-articles-message');

    function applyFilter() {
        const activeFilter = document.querySelector('.category-filter.active').dataset.filter;
        const articles = articlesContainer.querySelectorAll('.article-card');
        let visibleCount = 0;
        articles.forEach(article => {
            const show = activeFilter === 'all' || article.dataset.category === activeFilter;
            article.style.display = show ? 'flex' : 'none';
            if (show) visibleCount++;
        });
        noArticlesMsg.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    // Pagination AJAX
    document.addEventListener('click', e => {
        const link = e.target.closest('.pagination-nav a');
        if (!link) return;
        e.preventDefault();
        const url = new URL(link.href, location.origin);
        
        fetch(url)
            .then(r => r.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                articlesContainer.innerHTML = doc.querySelector('.blog-articles').innerHTML;
                history.pushState({}, '', url);
                applyFilter(); // Réapplique filtre
            });
    });

    // Init filtres
    filters.forEach(f => f.addEventListener('click', e => {
        e.preventDefault();
        filters.forEach(ff => ff.classList.remove('active'));
        f.classList.add('active');
        applyFilter();
    }));
});
</script>
