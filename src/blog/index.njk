---
layout: layouts/base.njk
eleventyComputed:
  eleventyNavigation:
    key: "blog"
    title: "{{ blog.blog.meta.title }}"
    parent: "accueil"
  seo:
    title: "{{ blog.blog.meta.title }}"
    description: "{{ blog.blog.meta.description }}"
    canonical: "{{ blog.blog.meta.canonical }}"
---

{% set data = blog.blog %}
{% set meta = data.meta %}

<section id="cover">
    <img src="{{ data.coverImage }}" alt="">

    
    <div class="container">
        <div class="page-header">
            <h1 class="section-title">{{ data.headerTitle }}</h1>
            <p class="sub-title">{{ meta.description }}</p>
        </div>
    </div>
</section>

{% set navigationBreadcrumb = [
  { title: "Accueil", url: "/" },
  { title: data.headerTitle }
] %}

{% include "layouts/_breadcrumb.njk" %}

<main id="blog-list">
    <section class="breadcrumb-sub">
        <div class="container">
            <h2>Liste des articles</h2>
            <div class="blog-layout">
                <!-- Articles List -->
                <div class="blog-articles">
                    {% for article in collections.blogPosts %}
                        <a href="/blog/{{ article.id }}" class="article-card" data-category="{{ article.category | slugify }}">
                            <div class="article-card_image">
                                <img src="{{ article.image }}" alt="{{ article.headerTitle }}" loading="lazy">
                            </div>
                            <div class="article-card_content">
                                <div class="article-card_header">
                                    <h2 class="article-card_title">{{ article.headerTitle }}</h2>
                                </div>
                                <div class="article-card_meta">
                                    <span class="article-card_read-time">{{ article.readTime }}</span>
                                    <span>{{ article.date }}</span>
                                    <span class="article-card_category">{{ article.category }}</span>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                    <div id="no-articles-message" class="blog-empty" style="display: none;">
                        <h3>Aucun article trouvé dans cette catégorie.</h3>
                    </div>
                </div>

                <!-- Category Table of Contents Sidebar -->
                <aside class="blog-toc">
                    <h3>Catégories</h3>
                    <nav>
                        <ul>
                            <li class="blog-toc_category">
                                <a href="#" class="active category-filter" data-filter="all">Tous les articles</a>
                            </li>
                            {% for category in collections.categories %}
                                <li class="blog-toc_category">
                                    <a href="#" class="category-filter" data-filter="{{ category.name | slugify }}">{{ category.name }} ({{ category.count }})</a>
                                </li>
                            {% endfor %}
                        </ul>
                    </nav>
                </aside>
            </div>
        </div>
    </section>

    <!-- Client-side Pagination Container -->
    <nav aria-label="Pagination" class="pagination-nav" id="pagination-container">
        <a href="#" id="pagination-prev">Précédent</a>
        <div class="pagination-numbers"></div>
        <a href="#" id="pagination-next">Suivant</a>
    </nav>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const articles = Array.from(document.querySelectorAll('.article-card'));
    const filters = document.querySelectorAll('.category-filter');
    const paginationNav = document.getElementById('pagination-container');
    const paginationPrev = document.getElementById('pagination-prev');
    const paginationNext = document.getElementById('pagination-next');
    const paginationNumbers = document.querySelector('.pagination-numbers');
    const noArticlesMsg = document.getElementById('no-articles-message');
    const ITEMS_PER_PAGE = 4;
    let currentPage = 1;

    function renderPagination(totalItems) {
        paginationNumbers.innerHTML = '';
        const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);

        if (totalPages === 0) {
            paginationNav.style.display = 'none';
            return;
        } else {
            paginationNav.style.display = 'flex';
        }

        const PAGES_PER_GROUP = 3;
        const currentGroup = Math.ceil(currentPage / PAGES_PER_GROUP);
        const totalGroups = Math.ceil(totalPages / PAGES_PER_GROUP);

        // Update Prev Button
        if (currentPage === 1) {
            paginationPrev.classList.add('disabled');
            paginationPrev.onclick = (e) => e.preventDefault();
        } else {
            paginationPrev.classList.remove('disabled');
            paginationPrev.onclick = (e) => { e.preventDefault(); currentPage--; updateDisplay(); };
        }

        // Update Next Button
        if (currentPage === totalPages) {
            paginationNext.classList.add('disabled');
            paginationNext.onclick = (e) => e.preventDefault();
        } else {
            paginationNext.classList.remove('disabled');
            paginationNext.onclick = (e) => { e.preventDefault(); currentPage++; updateDisplay(); };
        }

        // Ellipsis (Previous Group)
        if (currentGroup > 1) {
             const dotsPrev = document.createElement('a');
             dotsPrev.href = '#';
             dotsPrev.textContent = '...';
             dotsPrev.classList.add('ellipsis');
             dotsPrev.onclick = (e) => { 
                e.preventDefault(); 
                currentPage = (currentGroup - 1) * PAGES_PER_GROUP; 
                updateDisplay(); 
             };
             paginationNumbers.appendChild(dotsPrev);
        }

        // Page Numbers (Current Group Only)
        const startPage = (currentGroup - 1) * PAGES_PER_GROUP + 1;
        const endPage = Math.min(startPage + PAGES_PER_GROUP - 1, totalPages);

        for (let i = startPage; i <= endPage; i++) {
            const pageLink = document.createElement('a');
            pageLink.href = '#';
            pageLink.textContent = i;
            if (i === currentPage) pageLink.classList.add('current');
            pageLink.onclick = (e) => { e.preventDefault(); currentPage = i; updateDisplay(); };
            paginationNumbers.appendChild(pageLink);
        }

        // Ellipsis (Next Group)
        if (currentGroup < totalGroups) {
             const dotsNext = document.createElement('a');
             dotsNext.href = '#';
             dotsNext.textContent = '...';
             dotsNext.classList.add('ellipsis');
             dotsNext.onclick = (e) => { 
                e.preventDefault(); 
                currentPage = currentGroup * PAGES_PER_GROUP + 1; 
                updateDisplay(); 
             };
             paginationNumbers.appendChild(dotsNext);
        }
    }

    function updateDisplay() {
        const activeFilter = document.querySelector('.category-filter.active').dataset.filter;
        
        // 1. Filter articles
        const filteredArticles = articles.filter(article => {
            return activeFilter === 'all' || article.dataset.category === activeFilter;
        });

        // 2. Paginate
        const start = (currentPage - 1) * ITEMS_PER_PAGE;
        const end = start + ITEMS_PER_PAGE;
        const visibleArticles = filteredArticles.slice(start, end);

        // 3. Update DOM visibility
        articles.forEach(article => article.style.display = 'none'); // Hide all first
        visibleArticles.forEach(article => article.style.display = 'flex'); // Show only visible

        // 4. Show/Hide Empty Message
        noArticlesMsg.style.display = filteredArticles.length === 0 ? 'block' : 'none';

        // 5. Render Pagination Controls
        renderPagination(filteredArticles.length);
        
        // Scroll to top of list if changing pages (optional)
        if (filteredArticles.length > 0) {
            // const listTop = document.querySelector('.blog-list')?.offsetTop || 0;
            // window.scrollTo({ top: listTop, behavior: 'smooth' });
        }
    }

    // Init Filters
    filters.forEach(filter => {
        filter.addEventListener('click', (e) => {
            e.preventDefault();
            filters.forEach(f => f.classList.remove('active'));
            filter.classList.add('active');
            currentPage = 1; // Reset to page 1 on filter change
            updateDisplay();
        });
    });

    // Initial load
    updateDisplay();
});
</script>
